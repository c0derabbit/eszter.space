<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turning any website into a PWA with (mostly) vanilla JS</title>
    <meta name="description" content="">
    <link rel="alternate" href="." type="application/atom+xml" title="">
    <link rel="alternate" href="." type="application/json" title="">
  </head>
  <body>
    <header>
      <h1><a href="/"></a></h1>
    </header>

    <main>
      <h1>Turning any website into a PWA with (mostly) vanilla JS</h1>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps">Progressive web apps (PWAs)</a> are installable, responsive web applications that work on any device (within reason) and deliver a reliable experience on unreliable networks, and even work offline (once they’ve loaded, of course).</p>
<p>The <em>progressive</em> in the name suggests that they provide an <em>acceptable experience</em> on as many browsers as possible[^1], while offering an advanced experience on modern browsers, enabling new features as they become available.</p>
<h2>PWA availability in major web frameworks</h2>
<p><a href="https://www.gatsbyjs.org/docs/progressive-web-app/">Gatsby</a> and <a href="https://sapper.svelte.dev/docs#Deploying_service_workers">Sapper</a> offer it out of the box. It’s opt-in both in <a href="https://create-react-app.dev/docs/making-a-progressive-web-app/">React</a> and <a href="https://angular.io/api/service-worker">Angular</a>, and <a href="https://cli.vuejs.org/core-plugins/pwa.html">Vue offers a core plugin</a>. There’s a <a href="https://github.com/okitavera/eleventy-plugin-pwa">PWA plugin</a> for <a href="https://11ty.dev">11ty</a> too. So — we’re fairly well covered!</p>
<p>But what if we need something vanilla, or something <em>more specific</em>?</p>
<h2>PWA from scratch</h2>
<h3>1. Make it installable</h3>
<p>In practice, this is when the user can “add to home screen” on their mobile device. To achieve this, we need just a few things in <code>index.html</code>:</p>
<pre><code class="language-diff">  &lt;head&gt;
    &lt;title etc…&gt;
+   &lt;meta name=&quot;theme-color&quot; content=&quot;#f00&quot;&gt;
+   &lt;link rel=&quot;shortcut icon&quot; href=&quot;/favicon.ico&quot;&gt;
+   &lt;link rel=&quot;apple-touch-icon&quot; href=&quot;/path/to/icon.png&quot;&gt;
+   &lt;link rel=&quot;manifest&quot; href=&quot;/path/to/your.webmanifest&quot;&gt;
  &lt;/head&gt;
</code></pre>
<p>Now, we need to create those icons and the web manifest we refer to.</p>
<p><strong>your.webmanifest</strong> (you can call this anything, with a <code>.webmanifest</code> extension)</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;Your site – a cool web app&quot;,
  &quot;short_name&quot;: &quot;Your site&quot;,
  &quot;description&quot;: &quot;Here goes your awesome description&quot;,
  &quot;icons&quot;: [
    {
      &quot;src&quot;: &quot;icon32.png&quot;,
      &quot;sizes&quot;: &quot;32x32&quot;,
      &quot;type&quot;: &quot;image/png&quot;
    },
    {
      &quot;src&quot;: &quot;icon512.png&quot;,
      &quot;sizes&quot;: &quot;512x512&quot;,
      &quot;type&quot;: &quot;image/png&quot;
    }
  ],
  &quot;start_url&quot;: &quot;index.html&quot;,
  &quot;display&quot;: &quot;fullscreen&quot;,
  &quot;theme_color&quot;: &quot;#f00&quot;,
  &quot;background_color&quot;: &quot;#f00&quot;
}
</code></pre>
<p>If you run a Lighthouse audit now, the PWA section will already show some passed checks, e.g. web app manifest meets requirements, sets a theme colour, provides a valid <code>apple-touch-icon</code>.</p>
<p>It will, however, complain that your app “does not register a service worker.” Let’s get to that!</p>
<h3>2. Register the service worker[^2]</h3>
<p>This can be done <a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers">manually</a>, but today we’ll use <a href="https://developers.google.com/web/tools/workbox/modules/workbox-build">workbox-build</a>.</p>
<pre><code class="language-sh">$ yarn add --dev workbox-build
</code></pre>
<p>In your build script, after building the app:</p>
<pre><code class="language-js">const { generateSW } = require('workbox-build')

generateSW({
  globDirectory: 'dist', // or your build directory
  swDest: 'dist/sw.js', // or wherever you want to put your service worker
})
</code></pre>
<p>The last step is to register the service worker, and we’re good to go, with a green Lighthouse report.</p>
<pre><code class="language-html">&lt;script type=&quot;text/javascript&quot;&gt;
  if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/path/to/service-worker.js');
  }
&lt;/script&gt;
</code></pre>
<h3>A few notes</h3>
<p>If you have a very large number of pages linked from your front page (e.g. a blog), it may be a good idea to limit the number of pre-fetched pages or use pagination to avoid downloading old entries unnecessarily.</p>
<p>There are several service worker plugins for common build tools (e.g. Webpack, Rollup and Parcel) on <a href="https://www.npmjs.com">npm</a> — usually, it’s a good idea to use one of those for seamless integration.</p>
<p>Finally, if I’ve made a mistake, please <a href="mailto:ekov@pm.me">let me know</a>!</p>
<hr>
<h4>Footnotes</h4>
<p>[^1]: See <a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Introduction#Advantages_of_web_applications">Advantages of web applications</a> and <a href="https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement">Progressive Enhancement</a>, both on MDN.
[^2]: By the way, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">service workers can do much more</a> than make an app available offline.</p>


<hr>
<ul><li>Next: <a href="/noscript-lazy-load/">Accessible lazy-loading with a &lt;noscript&gt; fallback</a></li><li>Previous: <a href="/remote/">The great expectations of working remotely: 3-month check-in</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /pwa/ -->
  </body>
</html>
