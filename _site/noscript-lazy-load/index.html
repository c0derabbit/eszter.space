<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible lazy-loading with a &lt;noscript&gt; fallback</title>
    <meta name="description" content="">
    <link rel="alternate" href="." type="application/atom+xml" title="">
    <link rel="alternate" href="." type="application/json" title="">
  </head>
  <body>
    <header>
      <h1><a href="/"></a></h1>
    </header>

    <main>
      <h1>Accessible lazy-loading with a &lt;noscript&gt; fallback</h1>

<p>Designing for the <a href="https://blockmetry.com/blog/javascript-disabled">probably even less than 0.2%</a> may sound like an overkill. Static sites (such as Gatsby, Svelte, Jekyll, Hugo, 11ty etc.) will cover non-script users most of the time. But if you need more fine-grained control, <code>&lt;noscript&gt;</code> is here to save the day.</p>
<p>If you turn off JavaScript in a browser, and open up any React app, you’re quite likely to see the sentence <em>“This app works best with JavaScript enabled”</em> or similar. Looking at the source code[^1], this is the content of a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/noscript"><code>&lt;noscript&gt;</code> tag</a> — content that is only rendered when JavaScript is not available.</p>
<p>You can put mostly anything inside <code>&lt;noscript&gt;</code>, including <code>&lt;meta&gt;</code>, <code>&lt;link&gt;</code> and <code>&lt;style&gt;</code> tags. It’s a good place for fallback content and stylesheets.</p>
<h2>A real-life use case: lazy-loading images</h2>
<p>Using a library like <a href="https://github.com/verlok/vanilla-lazyload">vanilla-lazyload</a> already improves accessibility of a website, because it makes load time much faster, hence a smoother experience for users on average networks or devices.[^2]</p>
<p>The core concept behind lazy-loading is either omitting the <code>src</code> and replacing it with a <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes">data attribute</a>, or using a tiny version of the image with a blur-up effect.[^3] When the actual asset is loaded, it’s faded in using CSS. I’m omitting image width and height here, but you should try to set it to prevent content reflow.</p>
<h4>HTML</h4>
<pre><code class="language-html">&lt;img data-src=&quot;cat.png&quot; alt=&quot;My cat&quot; class=&quot;lazy&quot; id=&quot;cat&quot; /&gt;
</code></pre>
<h4>JS</h4>
<pre><code class="language-js">const catImg = document.getElementById(‘cat’)
const fullsizeSrc = catImg.dataset.src // from the data-src attribute
const loader = new Image()
loader.onload = () =&gt; {
	catImg.src = fullsizeSrc
  catImg.classList.add(‘loaded’)
}
// VERY important: .onload() has to come before .src assignment
loader.src = fullsizeSrc
</code></pre>
<h4>CSS</h4>
<pre><code class="language-css">.lazy {
  opacity: 0;
  transition: opacity .5s ease;
}

.lazy.loaded {
	opacity: 1;
}
</code></pre>
<p>The (admittedly edge-case) problem with these is, <strong>if there’s no JavaScript, the images will never be loaded</strong>. The solution is to add a non-lazy version for every lazy image, like so (and you can do this programmatically, at build time):</p>
<pre><code class="language-diff">  &lt;img data-src=&quot;cat.png&quot; alt=&quot;My cat&quot; class=&quot;lazy&quot; id=&quot;cat&quot; /&gt;
+ &lt;noscript&gt;
+  &lt;img src=&quot;cat.png&quot; alt=&quot;My cat&quot; /&gt;
+ &lt;/noscript&gt;
</code></pre>
<p>It will still be super fast, because whatever is inside <code>&lt;noscript&gt;</code> won’t load unless JavaScript is off. There’s still one issue to fix, though: hiding the lazy image placeholders when the <code>&lt;noscript&gt;</code> version kicks in. Here’s how, anywhere in your <code>&lt;head&gt;</code>:</p>
<pre><code class="language-diff">+ &lt;noscript&gt;
+   &lt;style type=&quot;text/css&quot;&gt;
+     .lazy { display: none; }
+   &lt;/style&gt;
+ &lt;/noscript&gt;
</code></pre>
<p>Alternatively, you can load an external stylesheet too.</p>
<p>That’s it for inclusive lazy-loading — <a href="https://github.com/c0derabbit/eszter.space/issues/new">let me know</a> if I’ve missed something!</p>
<hr>
<h4>Notes</h4>
<p>[^1]: See <a href="https://github.com/c0derabbit/react-redux-ts/blob/master/public/index.html#L16">react-redux-ts/index.html at master · c0derabbit/react-redux-ts · GitHub</a>
[^2]: Let’s not forget that as developers and/or designers, both our devices and network are likely to be superior to that of the average user.
[^3]: I’ve written about a <a href="/lazy-loading">React solution for the blur-up lazy loading here</a>.</p>


<hr>
<ul><li>Previous: <a href="/pwa/">Turning any website into a PWA with (mostly) vanilla JS</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /noscript-lazy-load/ -->
  </body>
</html>
